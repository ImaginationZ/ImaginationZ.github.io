---
layout: post
title: 数字图像处理笔记－直方图均衡与匹配
modified: 2013-09-29
description: 
image:
  feature: abstract-8.jpg
github: 
tags: [CV]
comments: true
share: true
---
我们在这里讨论的是一个图像域上的一个1X1临域的灰度变换：$$ s=T(r) $$，其中r为原图像灰度变量($$r\in[0, L-1]$$)，s为变换后图像灰度。这是一个最简单的灰度——灰度变换，一般被用于解决简单的图像增强(Enhance)问题。

我们知道所谓“直方图”反应了一幅图像中灰度的分布，严格的来说是图像中灰度概率密度的图像。在一般的图像中，直方图越平缓，则图像层次越丰富，对比越强烈；而直方图的峰聚集在横轴近端或远端，则图像偏灰或偏亮，等等。

这就提供了一个纯粹应用直方图而忽略图像本身的变换思路：即试图将图像的直方图拉平，以期达到Enhance的目的。具体的说，我们希望找到一个变换函数$$T(r)$$，使得任意的r的概率密度函数(PDF)$$p_r(r)$$在变换下满足$$p_s(s)=C=\frac{1}{L-1}$$。并且基本地，这个变换应当满足两点性质：
1.单调递增，使得变换下图像不会出现灰度层次的变化
2.值域在$$[0,L-1]$$。

由概率的知识，很容易导出：

$$
		p_s(s)=P_r(r)|\frac{dr}{ds}|
$$

我们考察含参变量积分形式的变换函数：

$$
		s = T(r) = (L-1) \int_{0}^{r} p_r(w) dw
$$

由于概率密度函数$$pr_r(r)$$是非负的，上式单调递增且落在$$[0,L-1]$$之间，符合要求。下面我们考察其变换后的灰度分布：

$$
		\frac{ds}{dr} = \frac{dT(r)}{dr} = (L-1)\frac{d}{dr}[\int_{0}^{r} p_r(w) dw] = (L-1)p_r(r)
$$

代入最上面的结果有

$$
		p_s(s)=P_r(r)|\frac{dr}{ds}| = p_r(r)|\frac{1}{(L-1)p_r(r)}| = \frac{1}{L-1}
$$

这是一个均匀密度函数。

因此我们从以上生成$$T(r)$$的步骤得知，我们可以得到均匀的$$p_s(s)$$,它与$$p_r(r)$$无关（生成$$T(r)$$的过程与$$p_r(r)$$相关）。

当然，平直的直方图曲线并不一定是最优的。有时候我们希望变换下的图像得到特定的直方图，意即，给定概率分布函数$$P_z(z)$$,我们要求得$$z = T'(r)$$,使得$$P_s(s) = P_z(z)$$。这被称作**直方图匹配**。

我们注意到对于$$P_z(z)$$，同样有：

$$
		s = G(z) = (L-1) \int_{0}^{z} p_z(w) dw
$$

对其取反函数，有

$$
	z = G^{-1}(s) = G^{-1}(T(r))
$$

这就给出了直方图匹配的一般思路：先求出原图像r的直方图均衡变换$$T(r)$$,再将其与待求图像r的均匀变换的逆变换$$z=G^{-1}(s)$$合成。

在实际操作中，寻找$$T(r)$$和$$G^{-1}(s)$$的表达式是比较困难的。幸而在图像存储的离散条件下，我们的操作可以大大简化。